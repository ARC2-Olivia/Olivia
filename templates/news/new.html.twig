{% extends 'base.html.twig' %}
{% trans_default_domain 'app' %}

{% block body %}
	<div class="index-banner" style="background-image: url('{{ asset('build/images/bg-index.png') }}')">
		<div class="container index-banner-wrapper">
			<div class="index-banner-title">{{ 'app.brand.short'|trans }}</div>
			<div class="index-banner-subtitle">{{ 'nav.news'|trans }}</div>
		</div>
	</div>
	
	<div class="container py-5">
		{% include '_partials/toasts.html.twig' %}
		<h1 class="mb-4">Nova novost</h1>
		{{ form_start(form, {'attr': {'id': form.vars.id}}) }}
			{{ form_label(form.title) }}
			{{ form_widget(form.title) }}
			
			<span>{{ form.content.vars.label|trans }}</span>
			<div class="editor-container mb-3">
				{% include '_partials/ql-editor-toolbar.html.twig' %}
				<div id="editor"></div>
			</div>
			{{ form_widget(form.content) }}
		
		<div class="text-end">
			<a href="{{ path('news_index') }}" class="btn btn-link me-3">{{ 'common.cancel'|trans }}</a>
			<button type="submit" class="btn btn-theme-white bg-blue">{{ 'common.submit'|trans }}</button>
		</div>
		{{ form_end(form) }}
	</div>
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	{{ encore_entry_link_tags('quill') }}
	<style>
		.editor-container {
			height: 440px;
			padding-bottom: 84px;
		}
	</style>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	{{ encore_entry_script_tags('quill') }}
	<script>
		const settings = { theme: "snow", modules: { toolbar: "#editor-toolbar" }, placeholder: `{{ 'form.entity.newsItem.placeholder.content'|trans }}` };
		const translation = { textCancel: '{{ 'common.cancel'|trans }}', textSubmit: '{{ 'common.submit'|trans }}' };

		window.onload = () => {
			const quill = new Quill("#editor", settings);
            quill.root.innerHTML = `{{ newsItem.content|raw }}`;
			QuillUtils.assignHtmlEditingCapabilities(quill, document.getElementById("editor-html"), translation)

			const form = document.querySelector("form#{{ form.vars.id }}");
			form.onsubmit = function(e) {
				const text = this.querySelector("#{{ form.content.vars.id }}");
				text.value = quill.root.innerHTML;
			};
		};
	</script>
{% endblock %}